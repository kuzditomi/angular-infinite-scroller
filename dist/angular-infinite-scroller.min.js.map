{"version":3,"sources":["webpack:///webpack/bootstrap 95e990bef1a8ca7b72ef","webpack:///./src/elements-manager.ts","webpack:///./src/module.ts","webpack:///./src/descriptor.ts","webpack:///./src/scroll-settings.ts","webpack:///./src/dom-manager.ts","webpack:///./src/scroll-detector.ts","webpack:///./src/scroller.ts","webpack:///./src/elements-manager-factory.ts","webpack:///./src/track-by-elements-manager.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","ElementsManager","descriptor","domManager","linker","_this","this","AddBottom","parentBottom","GetScrollBottomPosition","overflowCounter","Settings","BufferSize","displayTo","collection","length","item","transcludeElement","AppendElement","Element","items","push","blockEl","GetElementBottomPosition","RemoveTop","hasInvisibleChildren","el","GetScrollTopPosition","removeElement","displayFrom","RemoveBottom","GetElementTopPosition","updateScopes","TrackByExpression","maintainElementsWithTrackBy","overwriteScopes","Scope","IndexExpression","fixDisplayWindow","endDiff","fixedFrom","cleanUpBottom","index","childScope","$new","clone","splice","Remove","$destroy","$on","UpdateCollection","newCollection","fillBottom","AddTop","countTillStop","newElement","PrependElement","unshift","lastItem","descriptor_1","dom_manager_1","scroll_detector_1","scroller_1","elements_manager_factory_1","scrollerModule","angular","directive","parser","priority","restrict","transclude","link","scope","element","attr","_ctrl","Descriptor","createFrom","DOMManager","scrollDetector","ScrollDetector","elementsManager","ElementsManagerFactory","Scroller","Subscribe","scroll_settings_1","settings","ScrollSettings","expressionDesc","parseExpression","infiniteScroller","CollectionExpression","trackBy","expression","match","Error","lhs","rhs","trackByExp","settingsObject","size","parseInt","isNaN","_a","containerElement","offsetTop","scrollTop","offsetHeight","container","append","prepend","AppendElementToContainer","containerToAppend","PrependElementToContainer","containerToPrepend","parent","CreateRevealerElement","remove","GetRelativePositionOf","elementRatio","FixScroll","relativePosition","scrollTo","lastScrollTop","BUFFER_COUNT","SubscribeToElement","parentEl","onscroll","current","bottom","scrollHeight","OnScrollDown","topElement","children","OnScrollUp","clientHeight","onCollectionUpdated","onScrollDown","$apply","onScrollUp","$watchCollection","elements_manager_1","track_by_elements_manager_1","TrackByElementsManager","_super","trackByParser","__extends","_i","TrackByValue"],"mappings":"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","file":"angular-infinite-scroller.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 95e990bef1a8ca7b72ef","import { Descriptor } from './descriptor';\nimport { IDOMManager } from './dom-manager';\n\nexport interface Item {\n    Element: ng.IAugmentedJQuery;\n    Scope: ng.IScope;\n}\n\nexport interface IElementsManager {\n    UpdateCollection(newCollection: any[]): void;\n    AddTop(): void;\n    AddBottom(): void;\n    RemoveTop(): void;\n    RemoveBottom(): void;\n}\n\nexport class ElementsManager implements IElementsManager {\n    protected collection: any[];\n    protected items: Item[];\n    protected displayFrom: number;\n    protected displayTo: number;\n\n    public constructor(protected descriptor: Descriptor, protected domManager: IDOMManager, protected linker: ng.ITranscludeFunction) {\n        this.items = [];\n        this.displayFrom = 0;\n        this.displayTo = 0;\n\n        // this way the memory can only leak until the scroller lives\n        this.descriptor.Scope.$on('$destroy', () => {\n            this.items = [];\n        });\n    }\n\n    public UpdateCollection(newCollection: any[]) {\n        this.collection = newCollection;\n        this.fixDisplayWindow();\n        this.fillBottom();\n        this.updateScopes();\n        this.cleanUpBottom();\n    }\n\n    public AddTop() {\n        let countTillStop = this.descriptor.Settings.BufferSize;\n\n        let i = 0;\n        for (i = this.displayFrom - 1; i >= 0 && countTillStop > 0; i--) {\n            const newElement = this.transcludeElement(i);\n            this.domManager.PrependElement(newElement.Element);\n            this.items.unshift(newElement);\n\n            countTillStop--;\n        }\n\n        this.displayFrom = i + 1;\n    }\n\n    public AddBottom = () => {\n        const parentBottom = this.domManager.GetScrollBottomPosition();\n\n        // add this many children below visible area\n        let overflowCounter = this.descriptor.Settings.BufferSize;\n\n        let i = 0;\n        for (i = this.displayTo; i < this.collection.length && overflowCounter > 0; i++) {\n            const item = this.transcludeElement(i);\n            this.domManager.AppendElement(item.Element);\n            this.items.push(item);\n\n            const blockEl = item.Element;\n            const blockBottom = this.domManager.GetElementBottomPosition(blockEl);\n\n            if (blockBottom > parentBottom) {\n                overflowCounter--;\n            }\n        }\n\n        this.displayTo = i;\n    }\n\n    public RemoveTop = () => {\n        let hasInvisibleChildren = true;\n        while (hasInvisibleChildren) {\n            if (this.items.length <= this.descriptor.Settings.BufferSize) {\n                break;\n            }\n\n            const el = this.items[this.descriptor.Settings.BufferSize].Element;\n            const elementBottom = this.domManager.GetElementBottomPosition(el);\n            const scrollTop = this.domManager.GetScrollTopPosition();\n\n            if (elementBottom < scrollTop) {\n                this.removeElement(0);\n                this.displayFrom++;\n            } else {\n                hasInvisibleChildren = false;\n            }\n        }\n    }\n\n    public RemoveBottom = () => {\n        if (this.items.length < this.descriptor.Settings.BufferSize) {\n            return;\n        }\n\n        let hasInvisibleChildren = true;\n        while (hasInvisibleChildren) {\n            const el = this.items[this.items.length - this.descriptor.Settings.BufferSize].Element;\n            const elementTop = this.domManager.GetElementTopPosition(el);\n            const bottom = this.domManager.GetScrollBottomPosition();\n\n            if (elementTop > bottom) {\n                this.removeElement(this.items.length - 1);\n                this.displayTo--;\n            } else {\n                hasInvisibleChildren = false;\n            }\n        }\n    }\n\n    private fillBottom() {\n        const parentBottom = this.domManager.GetScrollBottomPosition();\n\n        // don't add more if elements are already out of sight\n        if (this.items.length > 0) {\n            const lastItem = this.items[this.items.length - 1];\n            const lastItemBottom = this.domManager.GetElementBottomPosition(lastItem.Element);\n\n            if (lastItemBottom > parentBottom) {\n                return;\n            }\n        }\n\n        this.AddBottom();\n    }\n\n    private updateScopes = () => {\n        if (this.descriptor.TrackByExpression) {\n            this.maintainElementsWithTrackBy();\n        } else {\n            this.overwriteScopes();\n        }\n    }\n\n    private overwriteScopes = () => {\n        for (let i = 0; i < this.items.length; i++) {\n            const item = this.items[i];\n            item.Scope[this.descriptor.IndexExpression] = this.collection[this.displayFrom + i];\n        }\n    }\n\n    private maintainElementsWithTrackBy = () => {\n        return 2;\n    }\n\n    private fixDisplayWindow = () => {\n        const endDiff = this.displayTo - this.collection.length;\n        if (endDiff > 0) {\n            this.displayTo -= endDiff;\n            const fixedFrom = this.displayFrom - endDiff;\n            this.displayFrom = fixedFrom > 0 ? fixedFrom : 0;\n        }\n    }\n\n    private cleanUpBottom = () => {\n        let i = this.collection.length;\n        while (i < this.items.length) {\n            this.removeElement(i);\n        }\n    }\n\n    private transcludeElement = (index: number): Item => {\n        const item = {} as Item;\n\n        const childScope = this.descriptor.Scope.$new();\n        childScope[this.descriptor.IndexExpression] = this.collection[index];\n\n        this.linker(childScope, (clone: ng.IAugmentedJQuery) => {\n            item.Element = clone;\n            item.Scope = childScope;\n        });\n\n        return item;\n    }\n\n    private removeElement = (index: number) => {\n        const item = this.items.splice(index, 1)[0];\n        this.domManager.Remove(item.Element);\n        item.Scope.$destroy();\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/elements-manager.ts","import { Descriptor } from './descriptor';\nimport { DOMManager } from './dom-manager';\nimport { ScrollDetector } from './scroll-detector';\nimport { Scroller } from './scroller';\nimport { ElementsManagerFactory } from './elements-manager-factory';\n\ndeclare var angular;\n\nexport const scrollerModule = angular.module('angular-infinite-scroller', []);\n\nscrollerModule.directive('infiniteScroller', ['$parse', (parser: ng.IParseService) => {\n    return {\n        priority: 1000,\n        restrict: 'A',\n        transclude: 'element',\n        link: (scope: ng.IScope, element: ng.IAugmentedJQuery, attr: ng.IAttributes, _ctrl, linker: ng.ITranscludeFunction) => {\n            const descriptor = Descriptor.createFrom(scope, attr);\n            const domManager = new DOMManager(element);\n            const scrollDetector = new ScrollDetector(element);\n            const elementsManager = ElementsManagerFactory.createFrom(descriptor, domManager, linker, parser);\n\n            const scroller = new Scroller(descriptor, scrollDetector, elementsManager);\n\n            scroller.Subscribe();\n        },\n    };\n}]);\n\n\n\n// WEBPACK FOOTER //\n// ./src/module.ts","import { ScrollSettings } from './scroll-settings';\n\ninterface IExpressionDescriptor {\n    index: string;\n    collection: string;\n    trackBy: string;\n}\n\nexport class Descriptor {\n    public Settings: ScrollSettings;\n    public CollectionExpression: string;\n    public IndexExpression: string;\n    public TrackByExpression: string;\n    public Scope: ng.IScope;\n\n    private constructor() { }\n\n    static createFrom(scope: ng.IScope, attr: ng.IAttributes): Descriptor {\n        const settings = ScrollSettings.createFrom(attr);\n        const expressionDesc = Descriptor.parseExpression(attr.infiniteScroller);\n\n        const descriptor = new Descriptor();\n        descriptor.CollectionExpression = expressionDesc.collection;\n        descriptor.IndexExpression = expressionDesc.index;\n        descriptor.TrackByExpression = expressionDesc.trackBy;\n        descriptor.Scope = scope;\n        descriptor.Settings = settings;\n\n        return descriptor;\n    }\n\n    private static parseExpression(expression: string): IExpressionDescriptor {\n        // parser logic mostly copied from ngRepeater https://github.com/angular/angular.js/blob/master/src/ng/directive/ngRepeat.js\n        let match = expression.match(/^\\s*([\\s\\S]+?)\\s+in\\s+([\\s\\S]+?)(?:\\s+as\\s+([\\s\\S]+?))?(?:\\s+track\\s+by\\s+([\\s\\S]+?))?\\s*$/);\n\n        if (!match) {\n            throw Error(`Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '${expression}'.`);\n        }\n\n        const lhs = match[1];\n        const rhs = match[2];\n        const trackByExp = match[4];\n\n        match = lhs.match(/^(?:(\\s*[$\\w]+)|\\(\\s*([$\\w]+)\\s*,\\s*([$\\w]+)\\s*\\))$/);\n\n        if (!match) {\n            throw '\\'_item_\\' in \\'_item_ in _collection_\\' should be an identifier or \\'(_key_, _value_)\\' expression, but got \\'{0}\\'.';\n        }\n\n        return {\n            collection: rhs,\n            index: match[1],\n            trackBy: trackByExp,\n        };\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/descriptor.ts","export class ScrollSettings {\n    BufferSize: number;\n\n    private constructor() {\n        this.BufferSize = 10;\n    }\n\n    static createFrom(attr: ng.IAttributes): ScrollSettings {\n        const settingsObject = new ScrollSettings();\n\n        if (attr['scrollBufferSize']) {\n            try {\n                const size = parseInt(attr['scrollBufferSize']);\n                if (isNaN(size))\n                    throw '';\n\n                settingsObject.BufferSize = size;\n            } catch {\n                throw 'could not initialize scroll settings, ScrollBufferSize is not a number';\n            }\n        }\n\n        return settingsObject;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroll-settings.ts","declare var angular;\n\nexport interface IDOMManager {\n    CreateRevealerElement(): ng.IAugmentedJQuery;\n\n    AppendElement(element: ng.IAugmentedJQuery): void;\n    PrependElement(element: ng.IAugmentedJQuery): void;\n    AppendElementToContainer(element: ng.IAugmentedJQuery, containerToAppend: ng.IAugmentedJQuery): void;\n    PrependElementToContainer(element: ng.IAugmentedJQuery, containerToPrepend: ng.IAugmentedJQuery): void;\n\n    GetScrollBottomPosition(): number;\n    GetScrollTopPosition(): number;\n    GetRelativePositionOf(elementRatio: number): number;\n\n    GetElementBottomPosition(element: ng.IAugmentedJQuery): number;\n    GetElementTopPosition(element: ng.IAugmentedJQuery): number;\n\n    FixScroll(relativePosition: number);\n    Remove(element: ng.IAugmentedJQuery): void;\n}\n\nexport class DOMManager implements IDOMManager {\n    private container: ng.IAugmentedJQuery;\n    private containerElement: HTMLElement;\n\n    constructor(element: ng.IAugmentedJQuery) {\n        this.container = element.parent();\n        this.containerElement = this.container[0];\n    }\n\n    CreateRevealerElement(): ng.IAugmentedJQuery {\n        return angular.element('<div class=\"revealer\"></div>');\n    }\n\n    GetElementTopPosition(element: ng.IAugmentedJQuery): number {\n        return element[0].offsetTop;\n    }\n    Remove(element: ng.IAugmentedJQuery): void {\n        element.remove();\n    }\n    GetScrollTopPosition = () => {\n        return this.containerElement.offsetTop + this.containerElement.scrollTop;\n    }\n    GetElementBottomPosition(element: ng.IAugmentedJQuery) {\n        return element[0].offsetTop + element[0].offsetHeight;\n    }\n    GetScrollBottomPosition = () => {\n        return this.containerElement.offsetTop + this.containerElement.scrollTop + this.containerElement.offsetHeight;\n    }\n    GetRelativePositionOf(elementRatio: number): number {\n        return this.containerElement.offsetTop + this.containerElement.offsetHeight * elementRatio;\n    }\n    AppendElement = (element: ng.IAugmentedJQuery) => {\n        this.container.append(element);\n    }\n    PrependElement = (element: ng.IAugmentedJQuery) => {\n        this.container.prepend(element);\n    }\n    AppendElementToContainer = (element: ng.IAugmentedJQuery, containerToAppend: ng.IAugmentedJQuery) => {\n        containerToAppend.append(element);\n    }\n    PrependElementToContainer = (element: ng.IAugmentedJQuery, containerToPrepend: ng.IAugmentedJQuery) => {\n        containerToPrepend.prepend(element);\n    }\n    FixScroll(relativePosition: number) {\n        this.containerElement.scrollTo(0, this.containerElement.offsetHeight * relativePosition);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom-manager.ts","export class ScrollDetector {\n    private lastScrollTop = 0;\n    private BUFFER_COUNT = 5;\n\n    public OnScrollDown?: () => void;\n    public OnScrollUp?: () => void;\n\n    constructor(private element: ng.IAugmentedJQuery) { }\n\n    public SubscribeToElement = () => {\n        const parentEl: HTMLElement = this.element.parent()[0];\n\n        parentEl.onscroll = () => {\n            if (this.lastScrollTop < parentEl.scrollTop) {\n                const current = parentEl.scrollTop + parentEl.offsetHeight;\n                const bottom = parentEl.scrollHeight;\n\n                if (this.OnScrollDown && current === bottom) {\n                    this.OnScrollDown();\n                }\n            } else if (this.lastScrollTop > parentEl.scrollTop) {\n                const topElement = parentEl.children[0];\n                if (this.OnScrollUp && parentEl.scrollTop <= (topElement.clientHeight * this.BUFFER_COUNT)) {\n                    this.OnScrollUp();\n                }\n            }\n            this.lastScrollTop = parentEl.scrollTop;\n        };\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroll-detector.ts","import { Descriptor } from './descriptor';\nimport { ScrollDetector } from './scroll-detector';\nimport { IElementsManager } from './elements-manager';\n\nexport class Scroller {\n    private get scope(): ng.IScope {\n        return this.descriptor.Scope;\n    }\n\n    public constructor(private descriptor: Descriptor, private scrollDetector: ScrollDetector, private elementsManager: IElementsManager) {\n        this.scrollDetector.OnScrollDown = this.onScrollDown;\n        this.scrollDetector.OnScrollUp = this.onScrollUp;\n    }\n\n    public Subscribe() {\n        this.scrollDetector.SubscribeToElement();\n        this.scope.$watchCollection(this.descriptor.CollectionExpression, this.onCollectionUpdated);\n    }\n\n    private onCollectionUpdated = (newCollection: any[]): void => {\n        this.elementsManager.UpdateCollection(newCollection);\n    }\n\n    private onScrollDown = (): void => {\n        this.scope.$apply(() => {\n            this.elementsManager.AddBottom();\n            this.elementsManager.RemoveTop();\n        });\n    }\n\n    private onScrollUp = (): void => {\n        this.scope.$apply(() => {\n            this.elementsManager.AddTop();\n            this.elementsManager.RemoveBottom();\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroller.ts","import { Descriptor } from './descriptor';\r\nimport { IDOMManager } from './dom-manager';\r\nimport { IElementsManager, ElementsManager } from './elements-manager';\r\nimport { TrackByElementsManager } from './track-by-elements-manager';\r\n\r\nexport class ElementsManagerFactory {\r\n    public static createFrom(descriptor: Descriptor, domManager: IDOMManager, linker: ng.ITranscludeFunction, parser: ng.IParseService): IElementsManager {\r\n        if (descriptor.TrackByExpression) {\r\n            return new TrackByElementsManager(descriptor, domManager, linker, parser);\r\n        }\r\n\r\n        return new ElementsManager(descriptor, domManager, linker);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/elements-manager-factory.ts","import { ElementsManager, Item } from './elements-manager';\r\nimport { Descriptor } from './descriptor';\r\nimport { IDOMManager } from './dom-manager';\r\n\r\ninterface TrackableItem extends Item {\r\n    TrackByValue: string;\r\n}\r\n\r\nexport class TrackByElementsManager extends ElementsManager {\r\n    private trackByParser: ng.ICompiledExpression;\r\n\r\n    public constructor(descriptor: Descriptor, domManager: IDOMManager, linker: ng.ITranscludeFunction, parser: ng.IParseService) {\r\n        super(descriptor, domManager, linker);\r\n\r\n        this.trackByParser = parser(descriptor.TrackByExpression);\r\n    }\r\n\r\n    public UpdateCollection(newCollection: any[]) {\r\n        super.UpdateCollection(newCollection);\r\n\r\n        for (let item of this.items) {\r\n            (item as TrackableItem).TrackByValue = this.trackByParser(item.Scope);\r\n        }\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/track-by-elements-manager.ts"],"sourceRoot":""}