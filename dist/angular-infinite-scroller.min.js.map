{"version":3,"sources":["webpack:///webpack/bootstrap 3e00be4624c27ea3e73b","webpack:///./src/module.ts","webpack:///./src/descriptor.ts","webpack:///./src/scroll-settings.ts","webpack:///./src/elements-manager.ts","webpack:///./src/dom-manager.ts","webpack:///./src/scroll-detector.ts","webpack:///./src/scroller.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","descriptor_1","elements_manager_1","dom_manager_1","scroll_detector_1","scroller_1","scrollerModule","angular","directive","priority","restrict","transclude","link","scope","element","attr","_ctrl","linker","descriptor","Descriptor","createFrom","domManager","DOMManager","scrollDetector","ScrollDetector","elementsManager","ElementsManager","Scroller","Subscribe","scroll_settings_1","settings","ScrollSettings","expressionDesc","parseExpression","infiniteScroller","CollectionExpression","collection","IndexExpression","index","TrackByExpression","trackBy","UseRevealer","undefined","Scope","Settings","expression","match","Error","lhs","rhs","trackByExp","this","BufferSize","settingsObject","size","parseInt","isNaN","_a","_this","UpdateCollection","newCollection","FillBottom","updateScopes","cleanUpBottom","AddTop","countTillStop","displayFrom","newElement","transcludeElement","PrependElement","Element","items","unshift","AddBottom","parentBottom","GetScrollBottomPosition","overflowCounter","displayTo","length","item","AppendElement","push","blockEl","GetElementBottomPosition","RemoveTop","hasInvisibleChildren","el","GetScrollTopPosition","removeElement","RemoveBottom","GetElementTopPosition","childScope","$new","clone","splice","Remove","$destroy","$on","lastItem","containerElement","offsetTop","scrollTop","offsetHeight","container","append","prepend","AppendElementToContainer","containerToAppend","PrependElementToContainer","containerToPrepend","parent","CreateRevealerElement","remove","GetRelativePositionOf","elementRatio","FixScroll","relativePosition","scrollTo","lastScrollTop","BUFFER_COUNT","SubscribeToElement","parentEl","onscroll","current","bottom","scrollHeight","OnScrollDown","topElement","children","OnScrollUp","clientHeight","onCollectionUpdated","onScrollDown","$apply","onScrollUp","$watchCollection"],"mappings":"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","file":"angular-infinite-scroller.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3e00be4624c27ea3e73b","import { Descriptor } from './descriptor';\r\nimport { ElementsManager } from './elements-manager';\r\nimport { DOMManager } from './dom-manager';\r\nimport { ScrollDetector } from './scroll-detector';\r\nimport { Scroller } from './scroller';\r\n\r\ndeclare var angular;\r\n\r\nexport const scrollerModule = angular.module('angular-infinite-scroller', []);\r\n\r\nscrollerModule.directive('infiniteScroller', () => {\r\n    return {\r\n        priority: 1000,\r\n        restrict: 'A',\r\n        transclude: 'element',\r\n        link: (scope: ng.IScope, element: ng.IAugmentedJQuery, attr: ng.IAttributes, _ctrl, linker: ng.ITranscludeFunction) => {\r\n            const descriptor = Descriptor.createFrom(scope, attr);\r\n            const domManager = new DOMManager(element);\r\n            const scrollDetector = new ScrollDetector(element);\r\n            const elementsManager = new ElementsManager(descriptor, domManager, linker);\r\n            const scroller = new Scroller(descriptor, scrollDetector, elementsManager);\r\n\r\n            scroller.Subscribe();\r\n        },\r\n    };\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/module.ts","import { ScrollSettings } from './scroll-settings';\r\n\r\ninterface ExpressionDescriptor {\r\n    index: string;\r\n    collection: string;\r\n    trackBy: string;\r\n}\r\n\r\nexport class Descriptor {\r\n    public Settings: ScrollSettings;\r\n    public CollectionExpression: string;\r\n    public IndexExpression: string;\r\n    public TrackByExpression: string;\r\n    public UseRevealer: boolean;\r\n    public Scope: ng.IScope;\r\n\r\n    private constructor() { }\r\n\r\n    static createFrom(scope: ng.IScope, attr: ng.IAttributes): Descriptor {\r\n        const settings = ScrollSettings.createFrom(attr);\r\n        const expressionDesc = Descriptor.parseExpression(attr.infiniteScroller);\r\n\r\n        const descriptor = new Descriptor();\r\n        descriptor.CollectionExpression = expressionDesc.collection;\r\n        descriptor.IndexExpression = expressionDesc.index;\r\n        descriptor.TrackByExpression = expressionDesc.trackBy;\r\n        descriptor.UseRevealer = attr['useRevealer'] !== undefined;\r\n        descriptor.Scope = scope;\r\n        descriptor.Settings = settings;\r\n\r\n        return descriptor;\r\n    }\r\n\r\n    private static parseExpression(expression: string): ExpressionDescriptor {\r\n        // parser logic mostly copied from ngRepeater https://github.com/angular/angular.js/blob/master/src/ng/directive/ngRepeat.js\r\n        let match = expression.match(/^\\s*([\\s\\S]+?)\\s+in\\s+([\\s\\S]+?)(?:\\s+track\\s+by\\s+([\\s\\S]+?))?\\s*$/);\r\n\r\n        if (!match) {\r\n            throw Error(`Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '${expression}'.`);\r\n        }\r\n\r\n        const lhs = match[1];\r\n        const rhs = match[2];\r\n        const trackByExp = match[3];\r\n\r\n        match = lhs.match(/^(?:(\\s*[$\\w]+))$/);\r\n\r\n        if (!match) {\r\n            throw Error(`'_item_' in '_item_ in _collection_' should be an identifier but got '${lhs}'.`);\r\n        }\r\n\r\n        return {\r\n            collection: rhs,\r\n            index: match[1],\r\n            trackBy: trackByExp,\r\n        };\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/descriptor.ts","export class ScrollSettings {\r\n    BufferSize: number;\r\n\r\n    private constructor() {\r\n        this.BufferSize = 10;\r\n    }\r\n\r\n    static createFrom(attr: ng.IAttributes): ScrollSettings {\r\n        const settingsObject = new ScrollSettings();\r\n\r\n        if (attr['scrollBufferSize']) {\r\n            try {\r\n                const size = parseInt(attr['scrollBufferSize']);\r\n                if (isNaN(size))\r\n                    throw '';\r\n\r\n                settingsObject.BufferSize = size;\r\n            } catch {\r\n                throw 'could not initialize scroll settings, ScrollBufferSize is not a number';\r\n            }\r\n        }\r\n\r\n        return settingsObject;\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroll-settings.ts","import { Descriptor } from './descriptor';\r\nimport { IDOMManager } from './dom-manager';\r\n\r\nexport type Item = {\r\n    Element: ng.IAugmentedJQuery;\r\n    Scope: ng.IScope;\r\n};\r\n\r\nexport interface IElementsManager {\r\n    UpdateCollection(newCollection: any[]): void;\r\n    AddTop(): void;\r\n    AddBottom(): void;\r\n    RemoveTop(): void;\r\n    RemoveBottom(): void;\r\n}\r\n\r\nexport class ElementsManager implements IElementsManager {\r\n    private collection: any[];\r\n    private items: Item[];\r\n    private displayFrom: number;\r\n    private displayTo: number;\r\n\r\n    constructor(private descriptor: Descriptor, private domManager: IDOMManager, private linker: ng.ITranscludeFunction) {\r\n        this.items = [];\r\n        this.displayFrom = 0;\r\n        this.displayTo = 0;\r\n\r\n        // this way the memory can only leak until the scroller lives\r\n        this.descriptor.Scope.$on('$destroy', () => {\r\n            this.items = [];\r\n        });\r\n    }\r\n\r\n    public UpdateCollection = (newCollection: any[]) => {\r\n        this.collection = newCollection;\r\n        this.FillBottom();\r\n        this.updateScopes();\r\n        this.cleanUpBottom();\r\n    }\r\n\r\n    public AddTop = () => {\r\n        let countTillStop = this.descriptor.Settings.BufferSize;\r\n\r\n        let i = 0;\r\n        for (i = this.displayFrom - 1; i >= 0 && countTillStop > 0; i--) {\r\n            const newElement = this.transcludeElement(i);\r\n            this.domManager.PrependElement(newElement.Element);\r\n            this.items.unshift(newElement);\r\n\r\n            countTillStop--;\r\n        }\r\n\r\n        this.displayFrom = i + 1;\r\n    }\r\n\r\n    public AddBottom = () => {\r\n        const parentBottom = this.domManager.GetScrollBottomPosition();\r\n\r\n        // add this many children below visible area\r\n        let overflowCounter = this.descriptor.Settings.BufferSize;\r\n\r\n        let i = 0;\r\n        for (i = this.displayTo; i < this.collection.length && overflowCounter > 0; i++) {\r\n            const item = this.transcludeElement(i);\r\n            this.domManager.AppendElement(item.Element);\r\n            this.items.push(item);\r\n\r\n            const blockEl = item.Element;\r\n            const blockBottom = this.domManager.GetElementBottomPosition(blockEl);\r\n\r\n            if (blockBottom > parentBottom) {\r\n                overflowCounter--;\r\n            }\r\n        }\r\n\r\n        this.displayTo = i;\r\n    }\r\n\r\n    public RemoveTop = () => {\r\n        let hasInvisibleChildren = true;\r\n        while (hasInvisibleChildren) {\r\n            if (this.items.length <= this.descriptor.Settings.BufferSize) {\r\n                break;\r\n            }\r\n\r\n            const el = this.items[this.descriptor.Settings.BufferSize].Element;\r\n            const elementBottom = this.domManager.GetElementBottomPosition(el);\r\n            const scrollTop = this.domManager.GetScrollTopPosition();\r\n\r\n            if (elementBottom < scrollTop) {\r\n                this.removeElement(0);\r\n                this.displayFrom++;\r\n            } else {\r\n                hasInvisibleChildren = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    public RemoveBottom = () => {\r\n        if (this.items.length < this.descriptor.Settings.BufferSize) {\r\n            return;\r\n        }\r\n\r\n        let hasInvisibleChildren = true;\r\n        while (hasInvisibleChildren) {\r\n            const el = this.items[this.items.length - this.descriptor.Settings.BufferSize].Element;\r\n            const elementTop = this.domManager.GetElementTopPosition(el);\r\n            const bottom = this.domManager.GetScrollBottomPosition();\r\n\r\n            if (elementTop > bottom) {\r\n                this.removeElement(this.items.length - 1);\r\n                this.displayTo--;\r\n            } else {\r\n                hasInvisibleChildren = false;\r\n            }\r\n        }\r\n    }\r\n\r\n    private FillBottom() {\r\n        const parentBottom = this.domManager.GetScrollBottomPosition();\r\n\r\n        // don't add more if elements are already out of sight\r\n        if (this.items.length > 0) {\r\n            const lastItem = this.items[this.items.length - 1];\r\n            const lastItemBottom = this.domManager.GetElementBottomPosition(lastItem.Element);\r\n\r\n            if (lastItemBottom > parentBottom) {\r\n                return;\r\n            }\r\n        }\r\n\r\n        this.AddBottom();\r\n    }\r\n\r\n    private updateScopes = () => {\r\n        for (let i = 0; i < this.items.length; i++) {\r\n            const item = this.items[i];\r\n            item.Scope[this.descriptor.IndexExpression] = this.collection[this.displayFrom + i];\r\n        }\r\n    }\r\n\r\n    private cleanUpBottom = () => {\r\n        let i = this.collection.length;\r\n        while (i < this.items.length) {\r\n            this.removeElement(i);\r\n            this.displayTo--;\r\n        }\r\n    }\r\n\r\n    private transcludeElement = (index: number): Item => {\r\n        const item = {} as Item;\r\n\r\n        const childScope = this.descriptor.Scope.$new();\r\n        childScope[this.descriptor.IndexExpression] = this.collection[index];\r\n\r\n        this.linker(childScope, (clone: ng.IAugmentedJQuery) => {\r\n            item.Element = clone;\r\n            item.Scope = childScope;\r\n        });\r\n\r\n        return item;\r\n    }\r\n\r\n    private removeElement = (index: number) => {\r\n        const item = this.items.splice(index, 1)[0];\r\n        this.domManager.Remove(item.Element);\r\n        item.Scope.$destroy();\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/elements-manager.ts","declare var angular;\r\n\r\nexport interface IDOMManager {\r\n    CreateRevealerElement(): ng.IAugmentedJQuery;\r\n\r\n    AppendElement(element: ng.IAugmentedJQuery): void;\r\n    PrependElement(element: ng.IAugmentedJQuery): void;\r\n    AppendElementToContainer(element: ng.IAugmentedJQuery, containerToAppend: ng.IAugmentedJQuery): void;\r\n    PrependElementToContainer(element: ng.IAugmentedJQuery, containerToPrepend: ng.IAugmentedJQuery): void;\r\n\r\n    GetScrollBottomPosition(): number;\r\n    GetScrollTopPosition(): number;\r\n    GetRelativePositionOf(elementRatio: number): number;\r\n\r\n    GetElementBottomPosition(element: ng.IAugmentedJQuery): number;\r\n    GetElementTopPosition(element: ng.IAugmentedJQuery): number;\r\n\r\n    FixScroll(relativePosition: number);\r\n    Remove(element: ng.IAugmentedJQuery): void;\r\n}\r\n\r\nexport class DOMManager implements IDOMManager {\r\n    private container: ng.IAugmentedJQuery;\r\n    private containerElement: HTMLElement;\r\n\r\n    constructor(element: ng.IAugmentedJQuery) {\r\n        this.container = element.parent();\r\n        this.containerElement = this.container[0];\r\n    }\r\n\r\n    CreateRevealerElement(): ng.IAugmentedJQuery {\r\n        return angular.element('<div class=\"revealer\"></div>');\r\n    }\r\n\r\n    GetElementTopPosition(element: ng.IAugmentedJQuery): number {\r\n        return element[0].offsetTop;\r\n    }\r\n    Remove(element: ng.IAugmentedJQuery): void {\r\n        element.remove();\r\n    }\r\n    GetScrollTopPosition = () => {\r\n        return this.containerElement.offsetTop + this.containerElement.scrollTop;\r\n    }\r\n    GetElementBottomPosition(element: ng.IAugmentedJQuery) {\r\n        return element[0].offsetTop + element[0].offsetHeight;\r\n    }\r\n    GetScrollBottomPosition = () => {\r\n        return this.containerElement.offsetTop + this.containerElement.scrollTop + this.containerElement.offsetHeight;\r\n    }\r\n    GetRelativePositionOf(elementRatio: number): number {\r\n        return this.containerElement.offsetTop + this.containerElement.offsetHeight * elementRatio;\r\n    }\r\n    AppendElement = (element: ng.IAugmentedJQuery) => {\r\n        this.container.append(element);\r\n    }\r\n    PrependElement = (element: ng.IAugmentedJQuery) => {\r\n        this.container.prepend(element);\r\n    }\r\n    AppendElementToContainer = (element: ng.IAugmentedJQuery, containerToAppend: ng.IAugmentedJQuery) => {\r\n        containerToAppend.append(element);\r\n    }\r\n    PrependElementToContainer = (element: ng.IAugmentedJQuery, containerToPrepend: ng.IAugmentedJQuery) => {\r\n        containerToPrepend.prepend(element);\r\n    }\r\n    FixScroll(relativePosition: number) {\r\n        this.containerElement.scrollTo(0, this.containerElement.offsetHeight * relativePosition);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom-manager.ts","export class ScrollDetector {\r\n    private lastScrollTop = 0;\r\n    private BUFFER_COUNT = 5;\r\n\r\n    public OnScrollDown?: () => void;\r\n    public OnScrollUp?: () => void;\r\n\r\n    constructor(private element: ng.IAugmentedJQuery) { }\r\n\r\n    public SubscribeToElement = () => {\r\n        const parentEl: HTMLElement = this.element.parent()[0];\r\n\r\n        parentEl.onscroll = () => {\r\n            if (this.lastScrollTop < parentEl.scrollTop) {\r\n                const current = parentEl.scrollTop + parentEl.offsetHeight;\r\n                const bottom = parentEl.scrollHeight;\r\n\r\n                if (this.OnScrollDown && current === bottom) {\r\n                    this.OnScrollDown();\r\n                }\r\n            } else if (this.lastScrollTop > parentEl.scrollTop) {\r\n                const topElement = parentEl.children[0];\r\n                if (this.OnScrollUp && parentEl.scrollTop <= (topElement.clientHeight * this.BUFFER_COUNT)) {\r\n                    this.OnScrollUp();\r\n                }\r\n            }\r\n            this.lastScrollTop = parentEl.scrollTop;\r\n        };\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroll-detector.ts","import { Descriptor } from './descriptor';\r\nimport { ScrollDetector } from './scroll-detector';\r\nimport { IElementsManager } from './elements-manager';\r\n\r\nexport class Scroller {\r\n    private get scope(): ng.IScope {\r\n        return this.descriptor.Scope;\r\n    }\r\n\r\n    public constructor(private descriptor: Descriptor, private scrollDetector: ScrollDetector, private elementsManager: IElementsManager) {\r\n        this.scrollDetector.OnScrollDown = this.onScrollDown;\r\n        this.scrollDetector.OnScrollUp = this.onScrollUp;\r\n    }\r\n\r\n    public Subscribe() {\r\n        this.scrollDetector.SubscribeToElement();\r\n        this.scope.$watchCollection(this.descriptor.CollectionExpression, this.onCollectionUpdated);\r\n    }\r\n\r\n    private onCollectionUpdated = (newCollection: any[]): void => {\r\n        this.elementsManager.UpdateCollection(newCollection);\r\n    }\r\n\r\n    private onScrollDown = (): void => {\r\n        this.scope.$apply(() => {\r\n            this.elementsManager.AddBottom();\r\n            this.elementsManager.RemoveTop();\r\n        });\r\n    }\r\n\r\n    private onScrollUp = (): void => {\r\n        this.scope.$apply(() => {\r\n            this.elementsManager.AddTop();\r\n            this.elementsManager.RemoveBottom();\r\n        });\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroller.ts"],"sourceRoot":""}