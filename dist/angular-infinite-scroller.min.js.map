{"version":3,"sources":["webpack:///webpack/bootstrap 2774d5baf2dc11117efc","webpack:///./src/module.ts","webpack:///./src/descriptor.ts","webpack:///./src/scroll-settings.ts","webpack:///./src/elements-manager.ts","webpack:///./src/dom-manager.ts","webpack:///./src/scroll-detector.ts","webpack:///./src/scroller.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","configurable","enumerable","get","n","__esModule","object","property","prototype","hasOwnProperty","p","s","descriptor_1","elements_manager_1","dom_manager_1","scroll_detector_1","scroller_1","scrollerModule","angular","directive","priority","restrict","transclude","link","scope","element","attr","_ctrl","linker","descriptor","Descriptor","createFrom","domManager","DOMManager","scrollDetector","ScrollDetector","elementsManager","ElementsManager","Scroller","Subscribe","scroll_settings_1","settings","ScrollSettings","expressionDesc","parseExpression","infiniteScroller","CollectionExpression","collection","IndexExpression","index","TrackByExpression","trackBy","UseRevealer","undefined","Scope","Settings","expression","match","Error","lhs","rhs","trackByExp","this","BufferSize","settingsObject","size","parseInt","isNaN","_a","_this","UpdateCollection","newCollection","fixDisplayWindow","fillBottom","updateScopes","cleanUpBottom","AddTop","countTillStop","displayFrom","newElement","transcludeElement","PrependElement","Element","items","unshift","AddBottom","parentBottom","GetScrollBottomPosition","overflowCounter","displayTo","length","item","AppendElement","push","blockEl","GetElementBottomPosition","RemoveTop","hasInvisibleChildren","el","GetScrollTopPosition","removeElement","RemoveBottom","GetElementTopPosition","endDiff","fixedFrom","childScope","$new","clone","splice","Remove","$destroy","$on","lastItem","containerElement","offsetTop","scrollTop","offsetHeight","container","append","prepend","AppendElementToContainer","containerToAppend","PrependElementToContainer","containerToPrepend","parent","CreateRevealerElement","remove","GetRelativePositionOf","elementRatio","FixScroll","relativePosition","scrollTo","lastScrollTop","BUFFER_COUNT","SubscribeToElement","parentEl","onscroll","current","bottom","scrollHeight","OnScrollDown","topElement","children","OnScrollUp","clientHeight","onCollectionUpdated","onScrollDown","$apply","onScrollUp","$watchCollection"],"mappings":"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","file":"angular-infinite-scroller.min.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 2774d5baf2dc11117efc","import { Descriptor } from './descriptor';\nimport { ElementsManager } from './elements-manager';\nimport { DOMManager } from './dom-manager';\nimport { ScrollDetector } from './scroll-detector';\nimport { Scroller } from './scroller';\n\ndeclare var angular;\n\nexport const scrollerModule = angular.module('angular-infinite-scroller', []);\n\nscrollerModule.directive('infiniteScroller', () => {\n    return {\n        priority: 1000,\n        restrict: 'A',\n        transclude: 'element',\n        link: (scope: ng.IScope, element: ng.IAugmentedJQuery, attr: ng.IAttributes, _ctrl, linker: ng.ITranscludeFunction) => {\n            const descriptor = Descriptor.createFrom(scope, attr);\n            const domManager = new DOMManager(element);\n            const scrollDetector = new ScrollDetector(element);\n            const elementsManager = new ElementsManager(descriptor, domManager, linker);\n            const scroller = new Scroller(descriptor, scrollDetector, elementsManager);\n\n            scroller.Subscribe();\n        },\n    };\n});\n\n\n\n// WEBPACK FOOTER //\n// ./src/module.ts","import { ScrollSettings } from './scroll-settings';\n\ninterface ExpressionDescriptor {\n    index: string;\n    collection: string;\n    trackBy: string;\n}\n\nexport class Descriptor {\n    public Settings: ScrollSettings;\n    public CollectionExpression: string;\n    public IndexExpression: string;\n    public TrackByExpression: string;\n    public UseRevealer: boolean;\n    public Scope: ng.IScope;\n\n    private constructor() { }\n\n    static createFrom(scope: ng.IScope, attr: ng.IAttributes): Descriptor {\n        const settings = ScrollSettings.createFrom(attr);\n        const expressionDesc = Descriptor.parseExpression(attr.infiniteScroller);\n\n        const descriptor = new Descriptor();\n        descriptor.CollectionExpression = expressionDesc.collection;\n        descriptor.IndexExpression = expressionDesc.index;\n        descriptor.TrackByExpression = expressionDesc.trackBy;\n        descriptor.UseRevealer = attr['useRevealer'] !== undefined;\n        descriptor.Scope = scope;\n        descriptor.Settings = settings;\n\n        return descriptor;\n    }\n\n    private static parseExpression(expression: string): ExpressionDescriptor {\n        // parser logic mostly copied from ngRepeater https://github.com/angular/angular.js/blob/master/src/ng/directive/ngRepeat.js\n        let match = expression.match(/^\\s*([\\s\\S]+?)\\s+in\\s+([\\s\\S]+?)(?:\\s+track\\s+by\\s+([\\s\\S]+?))?\\s*$/);\n\n        if (!match) {\n            throw Error(`Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '${expression}'.`);\n        }\n\n        const lhs = match[1];\n        const rhs = match[2];\n        const trackByExp = match[3];\n\n        match = lhs.match(/^(?:(\\s*[$\\w]+))$/);\n\n        if (!match) {\n            throw Error(`'_item_' in '_item_ in _collection_' should be an identifier but got '${lhs}'.`);\n        }\n\n        return {\n            collection: rhs,\n            index: match[1],\n            trackBy: trackByExp,\n        };\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/descriptor.ts","export class ScrollSettings {\n    BufferSize: number;\n\n    private constructor() {\n        this.BufferSize = 10;\n    }\n\n    static createFrom(attr: ng.IAttributes): ScrollSettings {\n        const settingsObject = new ScrollSettings();\n\n        if (attr['scrollBufferSize']) {\n            try {\n                const size = parseInt(attr['scrollBufferSize']);\n                if (isNaN(size))\n                    throw '';\n\n                settingsObject.BufferSize = size;\n            } catch {\n                throw 'could not initialize scroll settings, ScrollBufferSize is not a number';\n            }\n        }\n\n        return settingsObject;\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroll-settings.ts","import { Descriptor } from './descriptor';\nimport { IDOMManager } from './dom-manager';\n\nexport type Item = {\n    Element: ng.IAugmentedJQuery;\n    Scope: ng.IScope;\n};\n\nexport interface IElementsManager {\n    UpdateCollection(newCollection: any[]): void;\n    AddTop(): void;\n    AddBottom(): void;\n    RemoveTop(): void;\n    RemoveBottom(): void;\n}\n\nexport class ElementsManager implements IElementsManager {\n    private collection: any[];\n    private items: Item[];\n    private displayFrom: number;\n    private displayTo: number;\n\n    constructor(private descriptor: Descriptor, private domManager: IDOMManager, private linker: ng.ITranscludeFunction) {\n        this.items = [];\n        this.displayFrom = 0;\n        this.displayTo = 0;\n\n        // this way the memory can only leak until the scroller lives\n        this.descriptor.Scope.$on('$destroy', () => {\n            this.items = [];\n        });\n    }\n\n    public UpdateCollection = (newCollection: any[]) => {\n        this.collection = newCollection;\n        this.fixDisplayWindow();\n        this.fillBottom();\n        this.updateScopes();\n        this.cleanUpBottom();\n    }\n\n    public AddTop = () => {\n        let countTillStop = this.descriptor.Settings.BufferSize;\n\n        let i = 0;\n        for (i = this.displayFrom - 1; i >= 0 && countTillStop > 0; i--) {\n            const newElement = this.transcludeElement(i);\n            this.domManager.PrependElement(newElement.Element);\n            this.items.unshift(newElement);\n\n            countTillStop--;\n        }\n\n        this.displayFrom = i + 1;\n    }\n\n    public AddBottom = () => {\n        const parentBottom = this.domManager.GetScrollBottomPosition();\n\n        // add this many children below visible area\n        let overflowCounter = this.descriptor.Settings.BufferSize;\n\n        let i = 0;\n        for (i = this.displayTo; i < this.collection.length && overflowCounter > 0; i++) {\n            const item = this.transcludeElement(i);\n            this.domManager.AppendElement(item.Element);\n            this.items.push(item);\n\n            const blockEl = item.Element;\n            const blockBottom = this.domManager.GetElementBottomPosition(blockEl);\n\n            if (blockBottom > parentBottom) {\n                overflowCounter--;\n            }\n        }\n\n        this.displayTo = i;\n    }\n\n    public RemoveTop = () => {\n        let hasInvisibleChildren = true;\n        while (hasInvisibleChildren) {\n            if (this.items.length <= this.descriptor.Settings.BufferSize) {\n                break;\n            }\n\n            const el = this.items[this.descriptor.Settings.BufferSize].Element;\n            const elementBottom = this.domManager.GetElementBottomPosition(el);\n            const scrollTop = this.domManager.GetScrollTopPosition();\n\n            if (elementBottom < scrollTop) {\n                this.removeElement(0);\n                this.displayFrom++;\n            } else {\n                hasInvisibleChildren = false;\n            }\n        }\n    }\n\n    public RemoveBottom = () => {\n        if (this.items.length < this.descriptor.Settings.BufferSize) {\n            return;\n        }\n\n        let hasInvisibleChildren = true;\n        while (hasInvisibleChildren) {\n            const el = this.items[this.items.length - this.descriptor.Settings.BufferSize].Element;\n            const elementTop = this.domManager.GetElementTopPosition(el);\n            const bottom = this.domManager.GetScrollBottomPosition();\n\n            if (elementTop > bottom) {\n                this.removeElement(this.items.length - 1);\n                this.displayTo--;\n            } else {\n                hasInvisibleChildren = false;\n            }\n        }\n    }\n\n    private fillBottom() {\n        const parentBottom = this.domManager.GetScrollBottomPosition();\n\n        // don't add more if elements are already out of sight\n        if (this.items.length > 0) {\n            const lastItem = this.items[this.items.length - 1];\n            const lastItemBottom = this.domManager.GetElementBottomPosition(lastItem.Element);\n\n            if (lastItemBottom > parentBottom) {\n                return;\n            }\n        }\n\n        this.AddBottom();\n    }\n\n    private updateScopes = () => {\n        for (let i = 0; i < this.items.length; i++) {\n            const item = this.items[i];\n            item.Scope[this.descriptor.IndexExpression] = this.collection[this.displayFrom + i];\n        }\n    }\n\n    private fixDisplayWindow = () => {\n        const endDiff = this.displayTo - this.collection.length;\n        if (endDiff > 0) {\n            this.displayTo -= endDiff;\n            const fixedFrom = this.displayFrom - endDiff;\n            this.displayFrom = fixedFrom > 0 ? fixedFrom : 0;\n        }\n    }\n\n    private cleanUpBottom = () => {\n        let i = this.collection.length;\n        while (i < this.items.length) {\n            this.removeElement(i);\n        }\n    }\n\n    private transcludeElement = (index: number): Item => {\n        const item = {} as Item;\n\n        const childScope = this.descriptor.Scope.$new();\n        childScope[this.descriptor.IndexExpression] = this.collection[index];\n\n        this.linker(childScope, (clone: ng.IAugmentedJQuery) => {\n            item.Element = clone;\n            item.Scope = childScope;\n        });\n\n        return item;\n    }\n\n    private removeElement = (index: number) => {\n        const item = this.items.splice(index, 1)[0];\n        this.domManager.Remove(item.Element);\n        item.Scope.$destroy();\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/elements-manager.ts","declare var angular;\n\nexport interface IDOMManager {\n    CreateRevealerElement(): ng.IAugmentedJQuery;\n\n    AppendElement(element: ng.IAugmentedJQuery): void;\n    PrependElement(element: ng.IAugmentedJQuery): void;\n    AppendElementToContainer(element: ng.IAugmentedJQuery, containerToAppend: ng.IAugmentedJQuery): void;\n    PrependElementToContainer(element: ng.IAugmentedJQuery, containerToPrepend: ng.IAugmentedJQuery): void;\n\n    GetScrollBottomPosition(): number;\n    GetScrollTopPosition(): number;\n    GetRelativePositionOf(elementRatio: number): number;\n\n    GetElementBottomPosition(element: ng.IAugmentedJQuery): number;\n    GetElementTopPosition(element: ng.IAugmentedJQuery): number;\n\n    FixScroll(relativePosition: number);\n    Remove(element: ng.IAugmentedJQuery): void;\n}\n\nexport class DOMManager implements IDOMManager {\n    private container: ng.IAugmentedJQuery;\n    private containerElement: HTMLElement;\n\n    constructor(element: ng.IAugmentedJQuery) {\n        this.container = element.parent();\n        this.containerElement = this.container[0];\n    }\n\n    CreateRevealerElement(): ng.IAugmentedJQuery {\n        return angular.element('<div class=\"revealer\"></div>');\n    }\n\n    GetElementTopPosition(element: ng.IAugmentedJQuery): number {\n        return element[0].offsetTop;\n    }\n    Remove(element: ng.IAugmentedJQuery): void {\n        element.remove();\n    }\n    GetScrollTopPosition = () => {\n        return this.containerElement.offsetTop + this.containerElement.scrollTop;\n    }\n    GetElementBottomPosition(element: ng.IAugmentedJQuery) {\n        return element[0].offsetTop + element[0].offsetHeight;\n    }\n    GetScrollBottomPosition = () => {\n        return this.containerElement.offsetTop + this.containerElement.scrollTop + this.containerElement.offsetHeight;\n    }\n    GetRelativePositionOf(elementRatio: number): number {\n        return this.containerElement.offsetTop + this.containerElement.offsetHeight * elementRatio;\n    }\n    AppendElement = (element: ng.IAugmentedJQuery) => {\n        this.container.append(element);\n    }\n    PrependElement = (element: ng.IAugmentedJQuery) => {\n        this.container.prepend(element);\n    }\n    AppendElementToContainer = (element: ng.IAugmentedJQuery, containerToAppend: ng.IAugmentedJQuery) => {\n        containerToAppend.append(element);\n    }\n    PrependElementToContainer = (element: ng.IAugmentedJQuery, containerToPrepend: ng.IAugmentedJQuery) => {\n        containerToPrepend.prepend(element);\n    }\n    FixScroll(relativePosition: number) {\n        this.containerElement.scrollTo(0, this.containerElement.offsetHeight * relativePosition);\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/dom-manager.ts","export class ScrollDetector {\n    private lastScrollTop = 0;\n    private BUFFER_COUNT = 5;\n\n    public OnScrollDown?: () => void;\n    public OnScrollUp?: () => void;\n\n    constructor(private element: ng.IAugmentedJQuery) { }\n\n    public SubscribeToElement = () => {\n        const parentEl: HTMLElement = this.element.parent()[0];\n\n        parentEl.onscroll = () => {\n            if (this.lastScrollTop < parentEl.scrollTop) {\n                const current = parentEl.scrollTop + parentEl.offsetHeight;\n                const bottom = parentEl.scrollHeight;\n\n                if (this.OnScrollDown && current === bottom) {\n                    this.OnScrollDown();\n                }\n            } else if (this.lastScrollTop > parentEl.scrollTop) {\n                const topElement = parentEl.children[0];\n                if (this.OnScrollUp && parentEl.scrollTop <= (topElement.clientHeight * this.BUFFER_COUNT)) {\n                    this.OnScrollUp();\n                }\n            }\n            this.lastScrollTop = parentEl.scrollTop;\n        };\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroll-detector.ts","import { Descriptor } from './descriptor';\nimport { ScrollDetector } from './scroll-detector';\nimport { IElementsManager } from './elements-manager';\n\nexport class Scroller {\n    private get scope(): ng.IScope {\n        return this.descriptor.Scope;\n    }\n\n    public constructor(private descriptor: Descriptor, private scrollDetector: ScrollDetector, private elementsManager: IElementsManager) {\n        this.scrollDetector.OnScrollDown = this.onScrollDown;\n        this.scrollDetector.OnScrollUp = this.onScrollUp;\n    }\n\n    public Subscribe() {\n        this.scrollDetector.SubscribeToElement();\n        this.scope.$watchCollection(this.descriptor.CollectionExpression, this.onCollectionUpdated);\n    }\n\n    private onCollectionUpdated = (newCollection: any[]): void => {\n        this.elementsManager.UpdateCollection(newCollection);\n    }\n\n    private onScrollDown = (): void => {\n        this.scope.$apply(() => {\n            this.elementsManager.AddBottom();\n            this.elementsManager.RemoveTop();\n        });\n    }\n\n    private onScrollUp = (): void => {\n        this.scope.$apply(() => {\n            this.elementsManager.AddTop();\n            this.elementsManager.RemoveBottom();\n        });\n    }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./src/scroller.ts"],"sourceRoot":""}