var Descriptor=function(){function e(){}return e.createFrom=function(t,o,n){var r=n.infiniteScroller.match(/^\s*(.+)\s+in\s+(.*?)$/),l=r[1],i=r[2],c=new e;return c.CollectionString=i,c.IndexString=l,c.UseRevealer=void 0!=n.useRevealer,c.Element=o,c.Scope=t,c},e}(),ElementsManager=function(){return function(e,t){var o=this;this.descriptor=e,this.linker=t,this.BUFFER_COUNT=5,this.LOAD_COUNT=10,this.UpdateCollection=function(e){void 0==o.collection?(o.collection=e,o.AddBottom()):(o.collection=e,o.updateScopes())},this.AddTop=function(){for(var e=o.LOAD_COUNT,t=o.displayFrom-1;t>=0&&e>0;t--){var n=o.descriptor.Scope.$new();n[o.descriptor.IndexString]=o.collection[t];var r=o.transcludeElement(n,t);o.container.prepend(r.Element),o.items.unshift(r),e--}o.displayFrom=t+1},this.AddBottom=function(){for(var e=o.items.length>0?o.BUFFER_COUNT:o.LOAD_COUNT,t=o.displayTo;t<o.collection.length&&e>0;t++){var n=o.descriptor.Scope.$new();n[o.descriptor.IndexString]=o.collection[t];var r=o.transcludeElement(n,t);o.container.append(r.Element),o.items.push(r);var l=r.Element[0],i=o.containerElement.offsetTop+o.containerElement.scrollTop+o.containerElement.offsetHeight;o.containerElement.offsetTop+l.offsetTop+l.offsetHeight>i&&e--}o.displayTo=t},this.RemoveTop=function(){if(!(o.items.length<o.BUFFER_COUNT))for(var e=!0;e;){var t=o.items[o.BUFFER_COUNT].Element[0];t.offsetTop+t.offsetHeight<o.containerElement.offsetTop+o.containerElement.scrollTop?(o.removeElement(0),o.displayFrom++):e=!1}},this.RemoveBottom=function(){if(!(o.items.length<o.BUFFER_COUNT))for(var e=!0;e;)o.items[o.items.length-o.BUFFER_COUNT].Element[0].offsetTop>o.containerElement.offsetHeight+o.containerElement.scrollTop+o.containerElement.offsetHeight?(o.removeElement(o.items.length-1),o.displayTo--):e=!1},this.updateScopes=function(){for(var e=0;e<o.items.length;e++)o.items[e].Scope[o.descriptor.IndexString]=o.collection[o.displayFrom+e]},this.transcludeElement=function(e,t){var n={};return o.linker(e,function(t){n.Element=t,n.Scope=e}),n},this.removeElement=function(e){var t=o.items.splice(e,1)[0];t.Element.remove(),t.Scope.$destroy()},this.items=[],this.displayFrom=0,this.displayTo=0,this.container=e.Element.parent(),this.containerElement=this.container[0]}}(),ScrollDetector=function(){return function(){var e=this;this.lastScrollTop=0,this.BUFFER_COUNT=5,this.SubscribeTo=function(t){var o=t.parent(),n=o[0];o.bind("scroll",function(){if(e.lastScrollTop<n.scrollTop)n.scrollTop+n.offsetHeight==n.scrollHeight&&e.OnScrollDown&&e.OnScrollDown();else if(e.lastScrollTop>n.scrollTop){var t=n.children[0];n.scrollTop<t.scrollHeight*e.BUFFER_COUNT&&e.OnScrollUp&&e.OnScrollUp()}e.lastScrollTop=o[0].scrollTop})}}}(),Scroller=function(){function e(e,t,o){var n=this;this.descriptor=e,this.scrollDetector=t,this.elementsManager=o,this.onCollectionUpdated=function(e){n.elementsManager.UpdateCollection(e)},this.onScrollDown=function(){n.scope.$apply(function(){n.elementsManager.AddBottom(),n.elementsManager.RemoveTop()})},this.onScrollUp=function(){n.scope.$apply(function(){n.elementsManager.AddTop(),n.elementsManager.RemoveBottom()})},this.scrollDetector.OnScrollDown=this.onScrollDown,this.scrollDetector.OnScrollUp=this.onScrollUp,this.scrollDetector.SubscribeTo(e.Element),this.scope.$watchCollection(e.CollectionString,this.onCollectionUpdated)}return Object.defineProperty(e.prototype,"scope",{get:function(){return this.descriptor.Scope},enumerable:!0,configurable:!0}),e}(),__extends=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])};return function(t,o){function n(){this.constructor=t}e(t,o),t.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),RevealerScroller=function(e){function t(t,o,n){return e.call(this,t,o,n)||this}return __extends(t,e),t}(Scroller),ScrollerFactory=function(){function e(){}return e.createFrom=function(e,t){var o=new ScrollDetector,n=new ElementsManager(e,t);return e.UseRevealer?new RevealerScroller(e,o,n):new Scroller(e,o,n)},e}(),scrollerModule=angular.module("angular-infinite-scroller",[]);scrollerModule.directive("infiniteScroller",function(){return{transclude:"element",link:function(e,t,o,n,r){var l=Descriptor.createFrom(e,t,o);ScrollerFactory.createFrom(l,r)}}});